
from qiskit import QuantumCircuit, transpile
from qiskit_aer import AerSimulator
from qiskit.visualization import plot_histogram
import matplotlib.pyplot as plt
import os
from PIL import Image

# Detect headless mode
headless = not os.environ.get("DISPLAY")

# Create circuit
circ = QuantumCircuit(2)
circ.h(0)
circ.cx(0, 1)
circ.measure_all()

# Transpile for simulator
simulator = AerSimulator()
circ = transpile(circ, simulator)

# Run and get counts
result = simulator.run(circ).result()
counts = result.get_counts(circ)

print("Measurement Counts:", counts)

# Save circuit diagram
circuit_plot = circ.draw('mpl')
circuit_plot.savefig("circuit.png")
print("Circuit diagram saved as circuit.png")

# Save histogram
hist_plot = plot_histogram(counts, title='Bell-State counts')
hist_plot.savefig("histogram.png")
print("Histogram saved as histogram.png")

# ASCII preview function
def ascii_preview(image_path, width=80):
    img = Image.open(image_path)
    img = img.convert('L')  # grayscale
    img = img.resize((width, int(width * img.height / img.width / 2)))
    chars = "@%#*+=-:. "
    pixels = img.getdata()
    ascii_str = "".join(chars[min(pixel // 25, len(chars) - 1)] for pixel in pixels)
    for i in range(0, len(ascii_str), width):
        print(ascii_str[i:i+width])



# Show ASCII previews
print("\nCircuit Preview:")
ascii_preview("circuit.png")

print("\nHistogram Preview:")
ascii_preview("histogram.png")
