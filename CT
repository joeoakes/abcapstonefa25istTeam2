from qiskit import QuantumCircuit, transpile #neccessary mods for Qiskit to operate!
from qiskit_aer import AerSimulator
from qiskit.visualization import plot_histogram
import matplotlib.pyplot as plt
import os
from PIL import Image

# Detect headless mode
headless = not os.environ.get("DISPLAY")

# This is creating the ciruit
circ = QuantumCircuit(2) #this is creating a 2 q-bit circuit
circ.h(0) #H-gate is applied to the first circuit
circ.cx(0, 1) #This is where the CNOT gate is being applied.
#applying both the CNOT and H-gate will star to initilize the cirucit --> creating the Bell state.
circ.measure_all()

# Transpile for simulator for faster exeecution
simulator = AerSimulator()
circ = transpile(circ, simulator) #the circuit is on the simulator and the measurement counts are retireved.

# Run and get counts
result = simulator.run(circ).result()
counts = result.get_counts(circ)

print("Measurement Counts:", counts)

# Save circuit diagram
circuit_plot = circ.draw('mpl') #the diagram is being generated with the 'mpl' function.
#mpl is the matplotlib backened :))
circuit_plot.savefig("circuit.png") 
print("Circuit diagram saved as circuit.png")

# Save histogram
hist_plot = plot_histogram(counts, title='Bell-State counts') #the measurement of the counts are being set up to be displayed as the histogram
hist_plot.savefig("histogram.png")
print("Histogram saved as histogram.png")

# ASCII preview function
def ascii_preview(image_path, width=80):
    img = Image.open(image_path)
    img = img.convert('L')  # grayscale
    img = img.resize((width, int(width * img.height / img.width / 2)))
    chars = "@%#*+=-:. "
    pixels = img.getdata()
    ascii_str = "".join(chars[min(pixel // 25, len(chars) - 1)] for pixel in pixels) #'join' is being used to process every pixel that'll go towrds the final ASCII pic
    for i in range(0, len(ascii_str), width):
        print(ascii_str[i:i+width])



# Show ASCII previews is mainly used to convert a png into an ASCII art (I needed to do this in prder for it to print in the console).
print("\nCircuit Preview:")
ascii_preview("circuit.png") #this will output a low res pic of the circuit

print("\nHistogram Preview:")
ascii_preview("histogram.png") #this will output a low res pic of the histogram
